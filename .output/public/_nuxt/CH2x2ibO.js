import{_ as Y}from"./B84QNxn5.js";import{a as O,_ as at,b as T,h as nt,d as rt,f as G,u as ct,e as pt}from"./D0VmDo8X.js";import{_ as q,b as dt,a as ut}from"./BhFTgSo9.js";import{x as mt,y as ft,r as m,f as M,p as J,c as b,o as d,b as p,a as t,t as s,q as V,h as e,s as C,g as R,_ as _t,m as W,A as E,D as B,E as N,w as L,C as Z,j as H,d as z,F as xt,B as ht,u as yt}from"#entry";import bt from"./C0bP-pMt.js";import gt from"./BjGIX49s.js";import vt from"./BOANuRC-.js";import wt from"./Djzet_pG.js";import $t from"./Bm_KT7pz.js";import"./-L3FWA8C.js";import"./Bh8xAm8L.js";import"./CL_8sVNc.js";import"./C_3jShhY.js";import"./ZhWAdK_X.js";import"./CXJoCA8q.js";import"./BStCwsYf.js";import"./CGpLOLPM.js";import"./BRlXXSvV.js";import"./BgVJ6mL4.js";import"./jc0MLXVe.js";import"./CLs7nh7g.js";import"./CKoCaSaN.js";import"./B2lTKE3U.js";import"./C69VbVQL.js";import"./D_wMGvOc.js";import"./nPAa-kJ6.js";import"./DNhongRr.js";const K=mt("history",()=>{const w=m({});return{list:w,updateList:a=>w.value=a,resetList:()=>w.value={}}},{persist:{storage:ft.localStorage()}}),kt={class:"flex flex-col w-full max-w-md mx-auto space-y-2 rounded-md shadow primary-slate p-7"},It={class:"text-lg font-semibold text-center capitalize text-secondary"},St={for:"clientId",class:"text-xs text-secondary"},jt={key:0,class:"text-xs text-red-500 transition duration-300 ease-out animate-swingIn-top-fwd"},Ct={__name:"HistorySearchForm",emits:["showHistory"],setup(w,{emit:_}){const n=_,a=R(),f=K(),{s:$,e:k}=O(),{t:x,locale:I}=M(),r=m({clientId:"",lang:I.value}),S=m({clientId:!1}),g=m([]),h=m(!1),j=()=>S.value={clientId:!1},v=i=>{const u=g.value.find(P=>P.name===i);return u?u.message:""},y=async()=>{h.value=!0;try{const{apiResponse:i,validError:u}=await $fetch(a.public.server.history,{method:"POST",body:r.value,key:"history"});g.value=u,console.log("search history response: ",i),i===null?k(x("page.error.http_500")):typeof i?.pesake?.code=="number"?k(i?.pesake?.detail):Object.keys(i?.data).length>0&&(f.updateList(i.data),$(x("page.success.history_found")),n("showHistory",!0))}catch(i){k(x("page.error.global")),console.log("signin error: ",i)}finally{h.value=!1}};return J(()=>g.value,i=>{S.value=i&&i.length>0?{clientId:i.some(u=>u.name==="clientId")}:j()},{immediate:!0}),(i,u)=>{const P=at,A=T,D=q;return d(),b("div",kt,[p(P,{size:"w-24 h-24",class:"self-center"}),t("h4",It,s(i.$t("page.history.form.title")),1),t("form",{onSubmit:C(y,["prevent"]),"aria-label":"Search client form"},[t("div",null,[t("label",St,s(i.$t("page.history.label.client")),1),p(A,{id:"clientId",modelValue:e(r).clientId,"onUpdate:modelValue":u[0]||(u[0]=F=>e(r).clientId=F),"custom-class":"uppercase","border-radius":"rounded-md","border-color":"border-gray-300",autocomplete:"off"},null,8,["modelValue"]),e(S).clientId?(d(),b("p",jt,s(v("clientId")),1)):V("",!0)]),p(D,{type:"submit",label:i.$t("page.button.search"),loading:e(h),icon:"pi pi-search",iconPos:"right","pt:label":"text-sm",width:"w-full mt-5",class:"h-9","aria-label":"Search payment history"},null,8,["label","loading"])],32)])}}},Lt=()=>({formatAmount:a=>new Intl.NumberFormat("en-US").format(a),formatDate:a=>nt.parseZone(a).format("DD MMM, YYYY"),filterPayment:(a,f)=>f.filter($=>$.invoice.status===a.trim().toLowerCase())}),Pt={class:"w-full max-w-2xl p-2 mx-auto space-y-4 bg-white border border-gray-300 rounded-md"},Dt={class:"flex flex-col md:flex-row md:items-center justify-between pb-2.5 border-b border-gray-200 space-y-3 md:space-y-0"},zt={class:"flex flex-row items-center space-x-1.5"},Bt={class:"text-base font-semibold"},Nt={class:"text-sm"},Vt={class:"flex flex-row items-center space-x-1"},At={class:"pb-3 space-y-2"},Ft={class:"px-1.5 py-2 rounded bg-blue-100 border border-gray-300 space-y-1"},Ht={class:"pb-0.5 space-x-2 text-sm border-b border-gray-300"},Mt={class:"font-semibold text-slate-900"},Rt={class:"font-semibold text-slate-500"},Ut={class:"flex flex-row flex-wrap justify-between gap-3"},Et={class:"flex flex-col font-bold"},Yt={class:"text-xs text-slate-500"},Ot={class:"text-xl sm:text-2xl"},Tt={class:"flex flex-col font-bold"},Gt={class:"text-xs text-slate-500"},qt={class:"text-xl sm:text-2xl"},Jt={class:"flex flex-col font-bold"},Wt={class:"text-xs text-slate-500"},Zt={class:"text-xl sm:text-2xl"},Kt={class:"flex flex-col font-bold"},Qt={class:"text-xs text-slate-500"},Xt={class:"text-xl sm:text-2xl"},te={class:"flex flex-col font-bold"},ee={class:"text-xs text-slate-500"},se={class:"text-xl sm:text-2xl"},oe={class:"grid grid-cols-2 px-1.5 py-2 rounded bg-blue-100 border border-gray-300 divide-x-2 divide-gray-500"},le={class:"flex flex-col font-bold"},ie={class:"text-xs text-slate-500"},ae={class:"text-xl sm:text-2xl"},ne={class:"flex flex-col font-bold text-right"},re={class:"text-xs text-slate-500"},ce={class:"text-xl sm:text-2xl"},pe={class:"space-y-3","aria-label":"Payment history"},de={class:"flex items-center pb-1 space-x-1 border-b border-gray-300"},ue={class:"font-semibold"},me={class:"w-28"},fe={class:"pi pi-check-circle",style:{"font-size":"0.8rem","font-weight":"600"}},_e={class:"pi pi-check-circle",style:{"font-size":"0.8rem","font-weight":"600"}},xe={class:"pi pi-check-circle",style:{"font-size":"0.8rem","font-weight":"600"}},he={key:0,class:"space-y-4 divide-y divide-gray-300 sm:w-72 md:w-auto"},ye={class:"flex flex-row items-center space-x-2"},be={class:"flex flex-col"},ge={class:"text-xs sm:text-sm"},ve={class:"text-xs"},we={class:"font-bold sm:text-lg"},$e={class:"flex flex-col items-end space-y-1"},ke={class:"text-xs font-semibold tracking-tight"},Ie={class:"flex flex-col items-center space-x-2 space-y-1 sm:space-y-0 sm:flex-row"},Se={key:1,class:"flex flex-col items-center justify-center h-full space-y-4"},je={class:"text-xs font-medium text-center text-secondary"},Ce={__name:"HistorySummary",setup(w){const _=R(),n=K(),{formatAmount:a,formatDate:f,filterPayment:$}=Lt(),{invoiceStatus:k}=rt(),{e:x,s:I}=O(),{t:r,locale:S}=M(),g=m(!1),h=m(""),j=m(),v=m([]),y=m(""),i=m([]);W(()=>v.value=n.list.payments);const u=o=>j.value.toggle(o),P=E(()=>v.value.length>0),A=E(()=>y.value.trim().length>0),D=o=>{u(),y.value=o,v.value=$(o,n.list.payments)},F=()=>{y.value="",v.value=n.list.payments},Q=async()=>{g.value=!0;try{const{apiResponse:o,validError:l}=await $fetch(_.public.server.history,{method:"POST",body:{clientId:h.value,lang:S.value},key:"history"});i.value=l,console.log("search receipt response in summary: ",o),o===null?x(r("page.error.http_500")):typeof o.pesake.code=="number"?x(o.pesake.detail):Object.keys(o?.data).length>0&&(n.updateList(o.data),I(r("page.success.history_found")))}catch(o){x(r("page.error.global")),console.log("history summary error: ",o)}finally{g.value=!1}};return J(()=>i.value,o=>{o&&o.length>0&&x(o[0].message)},{immediate:!0}),(o,l)=>{const X=T,tt=q,et=wt,st=vt,U=dt,ot=gt,lt=bt,it=Y;return d(),b("div",Pt,[t("ul",Dt,[t("li",zt,[l[4]||(l[4]=t("span",{class:"p-1.5 bg-emerald-200 rounded"},[t("i",{class:"pi pi-user text-emerald-700"})],-1)),t("span",null,[t("h5",Bt,s(o.$t("page.history.label.client_history")),1),t("h6",Nt,s(o.$t("page.history.label.view_bill")),1)])]),t("li",Vt,[B(t("span",null,[...l[5]||(l[5]=[t("i",{class:"text-blue-500 pi pi-spinner animate-spin"},null,-1)])],512),[[N,e(g)]]),p(st,null,{default:L(()=>[p(X,{id:"searchIndex",modelValue:e(h),"onUpdate:modelValue":l[0]||(l[0]=c=>Z(h)?h.value=c:null),"custom-class":"uppercase","border-radius":"rounded-md","border-color":"border-gray-300",autocomplete:"off",placeholder:o.$t("page.history.label.client")},null,8,["modelValue","placeholder"]),p(et,null,{default:L(()=>[p(tt,{onClick:C(Q,["prevent"]),icon:"pi pi-search","pt:root":"h-[2.20rem]"})]),_:1})]),_:1})])]),t("div",At,[t("div",Ft,[t("p",Ht,[t("span",Mt,s(o.$t("page.history.label.bills")),1),t("span",Rt,s(o.$t("page.history.label.gb_recap")),1)]),t("ol",Ut,[t("li",Et,[t("span",Yt,s(o.$t("page.history.label.stats.total")),1),t("span",Ot,s(e(a)(e(n).list.totals.totalInvoices)),1)]),t("li",Tt,[t("span",Gt,s(o.$t("page.history.label.stats.paid")),1),t("span",qt,s(e(a)(e(n).list.totals.totalPaidInvoices)),1)]),t("li",Jt,[t("span",Wt,s(o.$t("page.history.label.stats.unpaid")),1),t("span",Zt,s(e(a)(e(n).list.totals.totalUnpaidInvoices)),1)]),t("li",Kt,[t("span",Qt,s(o.$t("page.history.label.stats.partial")),1),t("span",Xt,s(e(a)(e(n).list.totals.totalPartiallypaidInvoices)),1)]),t("li",te,[t("span",ee,s(o.$t("page.history.label.stats.late")),1),t("span",se,s(e(a)(e(n).list.totals.totalLateInvoices)),1)])])]),t("ol",oe,[t("li",le,[t("span",ie,s(o.$t("page.history.label.stats.amount.total")),1),t("span",ae,s(e(a)(e(n).list.totals.totalAmount))+s(e(_).public.settings.currency),1)]),t("li",ne,[t("span",re,s(o.$t("page.history.label.stats.amount.paid")),1),t("span",ce,s(e(a)(e(n).list.totals.totalPaidInvoicesAmount))+s(e(_).public.settings.currency),1)])])]),t("div",pe,[t("h5",de,[p(U,{"prime-icon":"pi pi-filter",onClick:C(u,["prevent"])}),t("span",ue,s(o.$t("page.history.label.stats.filter")),1),e(A)?(d(),H(U,{key:0,"prime-icon":"pi pi-times-circle",style:{"font-size":"0.9rem"},onClick:C(F,["prevent"])})):V("",!0),p(ot,{ref_key:"filter",ref:j},{default:L(()=>[t("ul",me,[t("li",{onClick:l[1]||(l[1]=C(c=>D("paid"),["prevent"])),class:"flex flex-row items-center justify-between p-1 text-sm cursor-pointer rounded-xs hover:bg-blue-500 hover:text-white"},[l[6]||(l[6]=z(" Paid ",-1)),B(t("i",fe,null,512),[[N,e(y)==="paid"]])]),t("li",{onClick:l[2]||(l[2]=C(c=>D("unpaid"),["prevent"])),class:"flex flex-row items-center justify-between p-1 text-sm cursor-pointer hover:bg-blue-500 hover:text-white rounded-xs"},[l[7]||(l[7]=z(" Unpaid ",-1)),B(t("i",_e,null,512),[[N,e(y)==="unpaid"]])]),t("li",{onClick:l[3]||(l[3]=C(c=>D("late"),["prevent"])),class:"flex flex-row items-center justify-between p-1 text-sm cursor-pointer hover:bg-blue-500 hover:text-white rounded-xs"},[l[8]||(l[8]=z(" Late ",-1)),B(t("i",xe,null,512),[[N,e(y)==="late"]])])])]),_:1},512)]),e(P)?(d(),b("ul",he,[(d(!0),b(xt,null,ht(e(v),c=>(d(),b("li",{key:c.transactionId,class:"flex flex-row justify-between py-1"},[t("div",ye,[l[10]||(l[10]=t("i",{class:"p-2 text-white bg-gray-700 rounded-full pi pi-receipt"},null,-1)),t("h5",be,[t("span",ge,"#"+s(c.invoice.invoiceCode),1),t("span",ve,[l[9]||(l[9]=t("i",{class:"mr-1 pi pi-user",style:{"font-size":"0.7rem","font-weight":"600"}},null,-1)),z(" "+s(c.client.firstName)+" "+s(c.client.lastName),1)]),t("span",we,s(e(a)(c.amount))+s(e(_).public.settings.currency),1)])]),t("div",$e,[t("span",ke,s(e(f)(c.invoice.issueDate)),1),t("span",Ie,[p(lt,{value:c.invoice.status,size:"small",severity:e(k)(c.invoice.status),class:"capitalize"},null,8,["value","severity"]),c?.url!==null?(d(),H(it,{key:0,to:c?.url,target:"_blank"},{default:L(()=>[...l[11]||(l[11]=[t("i",{class:"transition duration-200 ease-linear cursor-pointer hover:text-blue-500 pi pi-cloud-download download-icon"},null,-1)])]),_:1},8,["to"])):V("",!0)])])]))),128))])):(d(),b("div",Se,[l[12]||(l[12]=t("img",{src:G,class:"object-contain object-center h-44",alt:"Credit card payment illustration"},null,-1)),t("h5",je,s(o.$t("page.history.empty_bill")),1)]))])])}}},Le=_t(Ce,[["__scopeId","data-v-61ec7f96"]]),Pe={class:"grid w-full h-full md:grid-cols-[auto_1fr] lg:grid-cols-2","aria-label":"New receipt page"},De={class:"flex flex-col px-4 bg-topography","aria-label":"Search receipt form"},ze={class:"flex flex-col items-center justify-center h-full"},Be={class:"grid-rows-[auto_1fr_auto] items-center hidden h-full space-y-5 overflow-y-auto md:grid","aria-label":"Receipt information"},Ne={class:"flex justify-end w-full pt-1.5 pr-3"},Ve={key:0,class:"flex w-full h-full px-1"},Ae={key:1,class:"flex flex-col items-center justify-center h-full space-y-4"},Fe={class:"text-xs font-medium text-center text-secondary"},He={class:"flex justify-between w-full px-2 py-1 text-xs font-semibold text-right"},us={__name:"history",setup(w){const _=ct(),n=R(),{t:a}=M(),f=m(!1),$=new Date().getFullYear(),{canShowBillModal:k}=pt();yt({title:`${a("meta.history.title")} - ${n.public.appName}`,meta:[{name:"description",content:"My JAWDI application."}]}),W(()=>_.resetReceiptInfo());const x=()=>f.value=!0;return(I,r)=>{const S=Y,g=Ct,h=ut,j=Le,v=$t;return d(),b("header",Pe,[t("section",De,[p(S,{to:I.$localePath("/"),class:"py-1"},{default:L(()=>[...r[1]||(r[1]=[t("i",{class:"p-1.5 text-sm text-blue-400 transition duration-300 ease-linear rounded-full cursor-pointer bg-slate-200 hover:bg-slate-50 pi pi-arrow-circle-left hover:text-blue-500",style:{"font-size":"1.7rem"}},null,-1)])]),_:1},8,["to"]),t("div",ze,[p(g,{onShowHistory:x})])]),t("section",Be,[t("div",Ne,[p(h)]),e(f)?(d(),b("div",Ve,[p(j)])):(d(),b("div",Ae,[r[2]||(r[2]=t("img",{src:G,class:"object-contain object-center h-96",alt:"Credit card payment illustration"},null,-1)),t("h5",Fe,s(I.$t("page.history.empty_bill")),1)])),t("p",He,[t("span",null,[r[3]||(r[3]=t("span",{class:"mr-0.5"},"©",-1)),z(s(e($))+" - "+s(e(n).public.appName),1)]),t("span",null,s(I.$t("page.footer.rights")),1)])]),e(k)?(d(),H(v,{key:0,visible:e(f),"onUpdate:visible":r[0]||(r[0]=y=>Z(f)?f.value=y:null),maximizable:"",modal:""},{default:L(()=>[p(j)]),_:1},8,["visible"])):V("",!0)])}}};export{us as default};
